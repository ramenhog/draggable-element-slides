<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Draggable Elements with Vanilla JS</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/stef.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/rainbow.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section id="title">
          <div class="title-container">
            <h1>Draggable Elements with Vanilla JS</h1>
            <p><a class="social-links" href="http://ramenhog.com" target="_blank">Stef Liu</a> | <a class="social-links" href="https://twitter.com/ramenhog" target="_blank">@ramenhog</a></p>
            <img src="images/codepen.gif" alt="draggable-buddy-guy" />
          </div>
        </section>
        
        <section id="draggable-ui">
          <h2>Draggable UI's</h2>
          <ul>
            <li>File uploads</li>
            <li>Sorting/reordering elements</li>
            <li>Drag and drop to color</li>
          </ul>
          <div class="draggable-ui-images">
            <div class="draggable-ui-image"><img src="images/drag-drop-upload.gif" alt="File uploads" /></div>
            <div class="draggable-ui-image"><img src="images/reordering.gif" alt="Reordering elements" /></div>
            <div class="draggable-ui-image"><img src="images/drop-to-color.gif" alt="Drag and drop to color" /></div>
          </div>
        </section>
        
        <section id="event-object">
          <h2>Simple CSS Concepts</h2>
          <ul>
            <li>Draggable element - <strong>absolutely positioned</strong></li>
            <li>Parent container the element is draggable within - <strong>relatively positioned</strong></li>
          </ul>
        </section>
        
        <section id="steps">
          <h2>The basic steps</h2>
          <ol>
            <li><a href="#/step-1">Get initial click position</a></li>
            <li><a href="#/step-2">Get distance from initial click to element's top left corner</a></li>
            <li><a href="#/step-3">As mouse moves, get new mouse position</a></li>
            <li><a href="#/step-4">Determine new top left coordinates for element</a></li>
            <li><a href="#/step-5">Move element to new calculated coordinates</a></li>
          </ol>
        </section>

        <section id="step-1">
          <h2>1. Get initial click position</h2>
          <img src="images/step_1.jpg" class="step-image" alt="Get initial click position" />
        </section>
        <section id="step-1-details">
          <h2>1. Get initial click position (cont'd)</h2>
          <ul>
            <li>Attach handler to mousedown event listener</li>
            <li>
              Utilize <code>event</code> object to get initial position
            </li>
            <li>
              Set mousedown state
            </li>
          </ul>
          <pre>
            <code class="javascript">
var isMouseDown = false;

function mouseDown(e) {
  // set mousedown state
  isMouseDown = true;

  var mouseY = e.clientY;
  var mouseX = e.clientX;
}

function mouseUp(e) {
  isMouseDown = false;
}

elm.addEventListener("mousedown", mouseDown);
document.addEventListener("mouseup", mouseUp);
            </code>
          </pre>
        </section>

        <section id="step-2">
          <h2>2. Get distance from initial click to element's top left corner</h2>
          <img src="images/step_2.jpg" class="step-image" alt="Get distance from initial click to element's top left corner" />
        </section>
        <section id="step-2-details">
          <h2>2. Get distance from initial click to <br/>element's top left corner (cont'd)</h2>
          <ul>
            <li>
              Find element's top left position relative to parent container
            </li>
            <li>
              Subtract element's top left coordinates from initial click's coordinates
            </li>
          </ul>
          <pre>
            <code class="javascript">
// get elm top and left coordinates
var elmTop = elm.offsetTop;
var elmLeft = elm.offsetLeft;

// get diff from element top left to mousedown point
var diffY = mouseY - elmTop;
var diffX = mouseX - elmLeft;
            </code>
          </pre>
        </section>

        <section id="step-3">
          <h2>3. As mouse moves, get new mouse position</h2>
          <img src="images/step_3.jpg" class="step-image" alt="As mouse moves, get new mouse position" />
        </section>
        <section id="step-3-details">
          <h2>3. As mouse moves, get new mouse position (cont'd)</h2>
          <ul>
            <li>
              Attach handler to mousemove event listener
              <ul>
                <li>Handler should only be fired when mouse is <strong>clicked and moving</strong></li>
              </ul>
            </li>
            <li>Use mousemove <code>event</code> object to calculate new mouse coordinates</li>
          </ul>
          <pre>
            <code class="javascript">
function mouseMove(e) {
  // if mouse is not clicked, return and do nothing
  if (!isMouseDown) return;

  // get new mouse coordinates
  var newMouseY = e.clientY;
  var newMouseX = e.clientX;
}

document.addEventListener("mousemove", mouseMove);
            </code>
          </pre>
        </section>

        <section id="step-4">
          <h2>4. Determine new top left coordinates for element</h2>
          <img src="images/step_4.jpg" class="step-image" alt="Determine new top left coordinates for element" />
        </section>
        <section id="step-4-details">
          <h2>4. Determine new top left coordinates for element (cont'd)</h2>
          <ul>
            <li>Subtract difference calculations (<a href="#/step-2">Step 2</a>) from new mouse coordinates (<a href="#/step-3">Step 3</a>)</li>
          </ul>
          <pre>
            <code class="javascript">
var newElmTop = newMouseY - diffY,
    newElmLeft = newMouseX - diffX;
            </code>
          </pre>
        </section>

        <section id="step-5">
          <h2>5. Move element to new calculated coordinates</h2>
          <img src="images/step_5.jpg" class="step-image" alt="Move element to new calculated coordinates" />
        </section>
        <section id="step-5-details">
          <h2>5. Move element to new calculated coordinates (cont'd)</h2>
          <ul>
            <li>Set the element's <code>top</code> and <code>left</code> properties to new coordinates</li>
          </ul>
          <pre>
            <code class="javascript">
elm.style.top = newElmTop + 'px';
elm.style.left = newElmLeft + 'px';
            </code>
          </pre>
        </section>

        <section id="boundaries">
          <h2>Welp.</h2>
          <img src="images/out_of_container.jpg" class="step-image" alt="Element can be dragged outside parent container" />
        </section>

        <section id="boundaries-steps">
          <h2>How do we keep the element from being <br/>dragged outside the parent container?</h2>
          <ol>
            <li><a href="#/container-step-1">Get parent container dimensions</a></li>
            <li><a href="#/container-step-2">Check if element is within top &amp; left container bounds</a></li>
            <li><a href="#/container-step-3">Get new bottom and right element coordinates</a></li>
            <li><a href="#/container-step-4">Check if element is within bottom &amp; right container bounds</a></li>
          </ol>
        </section>

        <section id="container-step-1">
          <h2>1. Get parent container dimensions</h2>
          <pre>
            <code class="javascript">
var container = elm.offsetParent;
containerWidth = container.offsetWidth;
containerHeight = container.offsetHeight;
            </code>
          </pre>
        </section>

        <section id="container-step-2">
          <h2>2. Check if element is within <strong>top &amp; left</strong> container bounds</h2>
          <ul>
            <li>
              Element is outside of the parent container if:
              <ul>
                <li>new top element coordinate is <strong>less than</strong> 0</li>
                <li>new left element coordinate is <strong>less than</strong> 0</li>
              </ul>
            </li>
            <li>Set coordinates to topmost and/or leftmost coordinates if outside of parent</li>
          </ul>
          <pre>
            <code class="javascript">
// if elm is being dragged off top of the container...
if (newElmTop < 0) {
  newElmTop = 0;
}

// if elm is being dragged off left of the container...
if (newElmLeft < 0) {
  newElmLeft = 0;
}
            </code>
          </pre>
        </section>

        <section id="container-step-3">
          <h2>3. Get new <strong>bottom</strong> and <strong>right</strong> element coordinates</h2>
          <ul>
            <li>new bottom element coordinate = new top coordinate for element + element height</li>
            <li>new right element coordinate = new left coordinate for element + element width</li>
          </ul>
          <pre>
            <code class="javascript">
var newElmRight = newElmTop + elmHeight;

var newElmBottom = newElmLeft + elmWidth;
            </code>
          </pre>
        </section>

        <section id="container-step-4">
          <h2>4. Check if element is within <br/><strong>bottom &amp; right</strong> container bounds</h2>
          <ul>
            <li>
              Element is outside of the parent container if:
              <ul>
                <li>new bottom element coordinate is <strong>greater than</strong> element height</li>
                <li>new right element coordinate is <strong>greater than</strong> element width</li>
              </ul>
            </li>
            <li>Set coordinates to bottommost and/or rightmost coordinates if outside of parent</li>
          </ul>
          <pre>
            <code class="javascript">
// if elm is being dragged off bottom of the container...
if (newElmRight > containerHeight) {
  newElmTop = containerHeight - elmHeight;
}

// if elm is being dragged off right of the container...
if (newElmBottom > containerWidth) {
  newElmLeft = containerWidth - elmWidth;
}
            </code>
          </pre>
        </section>

        <section id="codepen-time">
          <h2>Let's see it in action.</h2>
          <p><a href="http://codepen.io/ramenhog/pen/37341d552dc3ae71dc4ba599bc26ead5/" target="_blank">CodePen time 🎉</a></p>
          <img src="images/end.gif" alt="Party parrot" />
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        history: true,

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          { src: 'plugin/markdown/marked.js' },
          { src: 'plugin/markdown/markdown.js' },
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
      });
    </script>
  </body>
</html>
